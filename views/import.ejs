<%- include("_header") -%>

<h1>Customer Import</h1>
<br />

<h4>Total number of records in the database:</h4>
<br />

<h4>Select a file with customers for Database insert</h4>
<form enctype="multipart/form-data">
  <input
    type="file"
    id="cusImport"
    name="filename"
    required
    class="btn btn-sm"
  />
  <p></p>
  <input
    type="submit"
    value="Import Customers"
    class="btn btn-primary btn-sm"
  />
</form>
<p id="result"></p>

<script>
  // Typically, if the script is large, we place it in a separate file
  //   For demonstrations, it is included in the same file.
  // Handle form submission
  document.querySelector("form").addEventListener("submit", (e) => {
    // Cancel default behavior of sending a synchronous POST request
    e.preventDefault();
    const formData = {
      filename: document.getElementById("cusImport").value,
    };
    // Create a FormData object, passing the form as a parameter
    // const formData = new FormData(e.target);
    // Send form data to the server with an asynchronous POST request
    debugger;
    const headers = {
      "Content-Type": "application/json",
    };
    fetch("/input", {
      method: "POST",
      headers,
      body: formData,
    })
      .then((response) => response.text())
      .then((data) => {
        debugger;
        const resultElement = document.getElementById("result");
        if (data.substring(0, 5) === "Error") {
          resultElement.innerText = `Error occurred!  ${data}`;
        } else {
          resultElement.innerText = data;
        }
      })
      .catch((err) => {
        document.getElementById(
          "message"
        ).textContent = `Error: ${err.message}`;
      });
  });
</script>

<%- include("_footer") -%>
